FROM ubuntu:25.04

# Install dependencies
RUN apt-get update -y
RUN apt-get install -y apache2

# Install apache and write hello world message
RUN echo "Hello World!" > /var/www/index.html

# Configure apache
RUN a2enmod rewrite
RUN chown -R www-data:www-data /var/www
RUN mkdir /var/run/apache2
ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_RUN_DIR /var/run/apache2
ENV APACHE_LOG_DIR /var/log/apache2

EXPOSE 80

CMD ["/usr/sbin/apache2", "-D", "FOREGROUND"]


aws ecr get-login-password --region us-west-1 | docker login --username AWS --password-stdin 949018924661.dkr.ecr.us-west-1.amazonaws.com


docker tag hello-world 949018924661.dkr.ecr.us-west-1.amazonaws.com/hello-world


{
	"family": "hello-world",
	"containerDefinitions": [
		{
			"name": "hello-world",
			"image": "949018924661.dkr.ecr.us-west-1.amazonaws.com/hello-world",
			"cpu": 10,
			"memory": 500,
			"portMappings": [
				{
					"containerPort": 80,
					"hostPort": 80
				}
			],
			"entryPoint": [
				"/usr/sbin/apache2",
				"-D",
				"FOREGROUND"
			],
			"essential": true
		}
	],
	"requiresCompatibilities": [
		"FARGATE"
	],
	"cpu": "256",
	"memory": "512",
	"executionRoleArn": "arn:aws:iam::949018924661:role/LabRole",
	"networkMode": "awsvpc"
}



{
  "requiresCompatibilities": [
    "FARGATE"
  ],
  "containerDefinitions": [
    {
      "name": "nginx",
      "image": "nginx:latest",
      "memory": 256,
      "cpu": 256,
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ],
      "logConfiguration":{
            "logDriver":"awslogs",
            "options":{
               "awslogs-group":"awslogs-nginx-ecs",
               "awslogs-region":"us-east-1",
               "awslogs-stream-prefix":"ecs"
            }
      }
    }
  ],
  "volumes": [],
  "networkMode": "awsvpc",
  "placementConstraints": [],
  "family": "nginx",
  "memory": "512",
  "cpu": "256",
  "executionRoleArn": "arn:aws:iam::949018924661:role/LabRole"
}


docker push 949018924661.dkr.ecr.us-west-1.amazonaws.com/hello-world



aws ecs create-cluster




aws ecs create-service --cluster fargate-cluster --service-name fargate-service --task-definition hello-world:1 --desired-count 1 --launch-type "FARGATE" --network-configuration "awsvpcConfiguration={subnets=[subnet-abcd1234],securityGroups=[sg-abcd1234],assignPublicIp=ENABLED}"


aws ecs list-task-definitions




{
  "requiresCompatibilities": [
    "FARGATE"
  ],
  "containerDefinitions": [
    {
      "name": "nginx",
      "image": "nginx:latest",
      "memory": 256,
      "cpu": 256,
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ],
    }
  ],
  "volumes": [],
  "networkMode": "awsvpc",
  "placementConstraints": [],
  "family": "nginx",
  "memory": "512",
  "cpu": "256",
  "executionRoleArn": "arn:aws:iam::949018924661:role/LabRole"
}


{
  "requiresCompatibilities": [
    "FARGATE"
  ],
  "containerDefinitions": [
    {
      "name": "nginx",
      "image": "nginx:latest",
      "memory": 256,
      "cpu": 256,
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ],
      "logConfiguration":{
      }
    }
  ],
  "volumes": [],
  "networkMode": "awsvpc",
  "placementConstraints": [],
  "family": "nginx",
  "memory": "512",
  "cpu": "256",
  "executionRoleArn": "arn:aws:iam::949018924661:role/LabRole"
}